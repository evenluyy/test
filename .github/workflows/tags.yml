name: Delete Old Tags

on:
  workflow_dispatch:
    inputs:
      tag_pattern:
        description: 'Tag pattern to delete (e.g. v1.*)'
        required: true
        default: 'openwrt_*'

jobs:
  delete-tags:
    runs-on: ubuntu-latest
    steps:
    - name: Checkout repository
      uses: actions/checkout@v4
      with:
        fetch-depth: 0  # 获取所有历史记录和tags

    - name: Delete local tags matching pattern
      run: |
        git tag -l "${{ inputs.tag_pattern }}" | xargs git tag -d
        git fetch --tags  # 重新获取远程tags以同步

    - name: Delete remote tags matching pattern
      run: |
        git tag -l "${{ inputs.tag_pattern }}" | xargs -I {} git push origin :refs/tags/{}
